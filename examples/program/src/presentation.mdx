import { Button } from "@r4ai/mercury-ui";

<div className="flex flex-col h-full justify-center max-w-3xl mx-auto">
  <h1 className="text-2xl font-semibold">スライド作成ツールの開発</h1>
  <p className="mt-4">HOGE HOGE</p>
</div>

---

# 背景

- **Markdown でスライドを作成したい**

  - 数式やコードブロックを簡単に表示したい
  - Git 管理したい
  - LLM を活用したい

- **Web の知識でスライドを作成したい**

  - 基本は Markdown で書く
  - 細かい調整は、HTML と CSS で行う
  - React コンポーネントを使えるようにする

⇒ **MDX (Markdown + JSX) からスライドを表示するウェブアプリを自動生成するツールを開発**

---

# キーワード

- **JSX (JavaScript XML)**: JS の拡張構文で、JS の中に HTML のような構文を埋め込むことができる

  ```jsx
  const element = <div className="text-red-500">Hello, World!</div>;
  ```

- **MDX (Markdown + JSX)**: Markdown の中に JSX を埋め込むことができる

  ```mdx
  # Hello, World!

  <div className="text-red-500">Hello, World!</div>
  ```

- **mdast**: Markdown の抽象構文木（AST）

- **hast**: HTML の抽象構文木（AST）

- **React**: UI コンポーネントを作成するための JavaScript ライブラリ

- **Vite**: フロントエンド開発のためのビルドツール

---

# アーキテクチャ

- MDX ファイルを入力として、スライドを表示するウェブアプリを自動生成する

{/* - 厳密にいうと...

  - MDX ファイルからいくつかの中間表現を経由しながら、React Component を生成する
  - この React Component は、単体でスライドを表示する機能を持つ
  - 生成した React Component を Vite でビルドすることで、ウェブアプリが完成する */}

<img className="mx-auto w-fit mt-12" src="/arch.drawio.svg" />

---

# 処理の流れ / MDX → mdast

<div className="flex flex-row gap-8">
  <div>
    ```mdx title="presentation.mdx"
    # スライド 1

    ---

    # スライド 2
    ```
  </div>
  <div className="py-32">
    <div className="flex flex-col items-center gap-2 justify-center">
      <span>⇒</span>
      <span>mdast へ変換</span>
    </div>
  </div>
  <div>
    ```json
    {
      "type": "root",
      "children": [
        {
          "type": "element",
          "tagName": "h1",
          "children": [{ "type": "text", "value": "Slide 1" }]
        },
        {
          "type": "element",
          "tagName": "hr",
          "children": []
        },
        {
          "type": "element",
          "tagName": "h1",
          "children": [{ "type": "text", "value": "Slide 2" }]
        }
      ]
    }
    ```
  </div>
</div>

---

# 処理の流れ / mdast → mdast

<div className="flex flex-row gap-8">
  <div>
    ```json
    {
      "type": "root",
      "children": [
        {
          "tagName": "h1",
          // ... 省略 ...
        },
        {
          "tagName": "hr",
          // ... 省略 ...
        },
        {
          "tagName": "h1",
          // ... 省略 ...
        }
      ]
    }
    ```
  </div>
  <div className="py-32">
    <div className="flex flex-col items-center gap-2 justify-center">
      <span>⇒</span>
      <span className="text-sm">構造化された\
            mdast へ変換</span>
    </div>
  </div>
  <div>
    ```json
    {
      "type": "root",
      "children": [
        {
          "type": "blockquote",
          "data": {
            "hName": "Presentation",
            "hProperties": { "slidesLength": 2 }
          },
          "children": [
            {
              "type": "blockquote",
              "data": { "hName": "Slide", "hProperties": { "index": 0 } },
              "children": [
                {
                  "type": "heading",
                  "depth": 1,
                  "children": [{ "type": "text", "value": "Slide 1" }]
                }
              ]
            }
            // ... slide 2 ...
    ```
  </div>
</div>

---

{/* # コラム: CommonMark について

- MDX は CommonMark をベースにしている

  https://spec.commonmark.org/0.31.2/

- CommonMark では、Markdown の要素は次の2つに分類できる：

  - **Container blocks**: 他の要素を含むことができる要素
  - **Leaf blocks**: 他の要素を含まない要素

- したがって、mdast 上でネストした構造を表現するためには、Container blocks を使う必要がある

- Container blocks としては block quote と list item がある。\
  本ツールでは、block containerを使うことで、プレゼンテーションのネスト構造を表現している

--- */}

# 処理の流れ / mdast → hast → JSX

1. 先程の構造化された mdast を、hast に変換する

   （構造自体はさほど変わらないので、省略する）

2. hast を、右のような JSX に変換する

   （実際はもっと複雑なものだが、簡略化したものを示している）

3. JSX を React を使って表示すれば、スライドが表示される

<div className="absolute right-8 top-24">
  ```jsx
  const MDXContent = ({ components }) => {
    return (
      <components.Presentation slidesLength={2}>
        <components.Slide index={0}>
          <components.h1>Slide 1</components.h1>
        </components.Slide>
        <components.Slide index={1}>
          <components.h1>Slide 2</components.h1>
        </components.Slide>
      </components.Presentation>
    );
  };

  export default MDXContent
  ```
</div>

---

# 処理の流れ / mdast → hast → JSX

- 描画に使用する component は、\
  すべて引数である `components` から渡される
- 実際にどんな component を使用するかは、\
  この変換の責務ではない

<br />

つまり...

- 通常のアプリ開発のように component を作り渡せば、\
  スライドを表示するアプリとして機能する

  👉️ Web の知識だけで開発できる

- 生成される JSX は、UI ライブラリに依存しない

  👉️ React 以外にも容易に対応できる

<div className="absolute right-8 top-24">
  ```jsx
  import { components } from "@r4ai/mercury-ui";

  const MDXContent = ({ components } = { components }) => {
    return (
      <components.Presentation slidesLength={2}>
        <components.Slide index={0}>
          <components.h1>Slide 1</components.h1>
        </components.Slide>
        <components.Slide index={1}>
          <components.h1>Slide 2</components.h1>
        </components.Slide>
      </components.Presentation>
    );
  };

  export default MDXContent
  ```
</div>

---

# 処理の流れ / JSX → HTML, CSS, JavaScript

- 変換された JSX をインポートする

  - MDX から JSX までの変換は、インポート時に自動的に行われる

    （Viteのプラグインとして実装されている）

- 読み込んだ JSX を、ReactDOM.createRoot で画面上に表示する

- Vite でビルドすることで、HTML, CSS, JavaScript が生成される

  - 成果物をデプロイすれば、ウェブアプリとして公開できる

    ブラウザ上で、PDFとして保存することも可能

```tsx
import Presentation  from "./presentation.mdx";

ReactDOM.createRoot(document.getElementById("root")!).render(
  <React.StrictMode>
    <Presentation />
  </React.StrictMode>,
)
```

---

# 機能の紹介 / 数式とソースコードの表示

<div className="flex flex-row gap-8">
  <div>
    ````mdx
    ソースコード：

    ```js
    const hello = () => {
      console.log("Hello, World!");
    }
    ```
    ````
  </div>
  <div className="py-16">
    <div className="flex flex-col items-center gap-2 justify-center">
      <span>⇒</span>
    </div>
  </div>
  <div>
    ソースコード：

    ```js
    const hello = () => {
      console.log("Hello, World!");
    }
    ```
  </div>
</div>

<div className="flex flex-row gap-8">
  <div>
    ````mdx
    数式：

    $$
    \forall \epsilon > 0,
    \exists \delta > 0,
    \forall x, |x - a| < \delta \Rightarrow
    |f(x) - f(a)| < \epsilon
    $$
    ````
  </div>
  <div className="py-16">
    <div className="flex flex-col items-center gap-2 justify-center">
      <span>⇒</span>
    </div>
  </div>
  <div>
    数式：

    $$
    \forall \epsilon > 0,
    \exists \delta > 0,
    \forall x, |x - a| < \delta \Rightarrow |f(x) - f(a)| < \epsilon
    $$
  </div>
</div>

---

# 既存のツールとの比較

{/* TODO: table のデザインを追加する */}

| 特徴         | Mercury                               | Slidev   |
| ------------ | ------------------------------------- | -------- |
| 言語         | MDX                                   | Markdown |
| UIライブラリ | React (今後 SolidJS などにも対応予定) | Vue      |
| スタイル     | TailwindCSS                           | UnoCSS   |
| ビルドツール | Vite                                  | Vite     |

---

# まとめ

- MDX ファイルからスライドを作成するソフトウェアを開発した

  - MDX → JSX への変換処理
  - スライドを表示するウェブアプリ（SPA）の自動生成

- GitHub: https://github.com/r4ai/mercury

---

質問対応
